<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Schedule a Session - The Self Care Lab</title>
  <meta name="description" content="Book your counseling session with Naresh - Individual & Couple Therapy Available">
  <meta name="keywords" content="counseling, therapy, booking, appointment, mental health, self care">

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
    rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/fontawesome-free/css/all.min.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">

  <!-- Main CSS File -->
  <link href="assets/css/main.css" rel="stylesheet">

</head>

<body class="booking-page">

  <header id="header" class="header sticky-top">

    <div class="topbar d-flex align-items-center">
      <div class="container d-flex justify-content-center justify-content-md-between">
        <div class="d-none d-md-flex align-items-center">
          <!-- <i class="bi bi-clock me-1"></i> -->
          <!-- Monday - Saturday, 9AM to 7PM -->
        </div>
        <div class="d-flex align-items-center">
          <div class="d-flex align-items-center">
            <a href="tel:+917506802501"
               class="d-flex align-items-center phone-link"
               style="color: black; text-decoration: none;">
              <i class="bi bi-phone me-1"></i> Schedule a consultation at +91 7506802501
            </a>
          </div>
        </div>
      </div>

      
    </div><!-- End Top Bar -->

    <div class="branding d-flex align-items-center">

      <div class="container position-relative d-flex align-items-center justify-content-end">
        <a href="index.html" class="logo d-flex align-items-center me-auto">
          <!-- <img src="assets/img/TheSelfCareLab/final_logo.svg" alt="" -->
           <img src="assets/img/TheSelfCareLab/BlackLogo.png" alt="" 
            style="width: 120px; height: auto; max-height: 80px;">
        </a>

        <nav id="navmenu" class="navmenu">
          <ul>
            <li><a href="index.html#hero" class="active">Home</a></li>
            <li><a href="index.html#about">About</a></li>
            <li><a href="index.html#services-offered">Services</a></li>
            <!-- <li><a href="#pricing">Pricing</a></li> -->
            <li class="dropdown"><a href="#"><span>Resources</span> <i
                  class="bi bi-chevron-down toggle-dropdown"></i></a>
              <ul>
                <li><a href="https://www.linkedin.com/posts/drshark_people-love-togossip-about-your-failures-activity-7379477770428461056-i5JN/?utm_source=share&utm_medium=member_desktop&rcm=ACoAADeycHABLtRyJjl83Wfnd4syVXGnLRNRYB4" target="_blank">Personal Blog</a></li>
                <!-- <li><a href="https://www.linkedin.com/feed/update/urn:li:activity:7380451528999919616/" target="_blank">Articles & Research</a></li> -->
                <li><a href="index.html#testimonials">Success Stories</a></li>
              </ul>
            </li>
            <!-- <li><a href="#contact">Contact</a></li> -->
            <li><a href="booking.html">Schedule a Meet</a></li>
          </ul>
          <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
        </nav>

        <button id="book-now-btn" class="cta-btn" style="background:none;border:none;padding:0;cursor:pointer;">Book Now</button>

      </div>

    </div>

  </header>

  <main class="main">

    <!-- Main Booking Section -->
    <section id="booking-section" class="booking-main section">
      <div class="container">
        
        <!-- Booking Intro -->
        <div class="row mb-4" data-aos="fade-up">
          <div class="col-12 text-center">
            <h2 class="booking-intro-title mb-2" style="display:inline-block;padding:0.5rem 0.9rem;background:#eefaf3;border-radius:10px;color:#064;">Schedule Your Session</h2>
            <div class="mt-2">
              <div class="small-discovery-card-wrapper text-center">
                <div class="service-card small-discovery-card d-inline-flex align-items-center">
                  <div class="small-discovery-text me-3">
                    <div>Confused or want to know more?</div>
                    <div>Schedule a free 10-minute discovery call.</div>
                  </div>
                  <div class="small-discovery-controls d-flex align-items-center">
                    <button id="copy-number" class="btn btn-sm btn-outline-secondary">+91 7506802501</button>
                    <a id="discovery-call-top" href="tel:+917506802501" class="btn btn-sm btn-primary ms-2">Discovery Call</a>
                  </div>
                </div>
              </div>
            </div>
            <!-- <p class="booking-intro-subtext mb-0">Book your personalized counseling session with real-time availability</p> -->
          </div>
        </div>

        <!-- Service Selection Cards -->
        <div class="row mb-5" data-aos="fade-up">
          <div class="col-12">
            <h2 class="text-center mb-4">Choose Your Service</h2>
            <div id="service-cards" class="service-cards">
              
              <!-- Counselling Session 1:1 -->
              <div class="service-card" data-service="counselling-1to1">
                <div class="service-icon">
                  <i class="bi bi-person-circle"></i>
                </div>
                <h4>Counselling Session 1:1</h4>
                <div class="service-price">₹1,500 <span>per session</span></div>
                <ul class="service-features">
                  <li><i class="bi bi-check-circle-fill"></i>50 minute session</li>
                  <li><i class="bi bi-check-circle-fill"></i>One-on-one therapy</li>
                  <li><i class="bi bi-check-circle-fill"></i>Online & offline available</li>
                  <li><i class="bi bi-check-circle-fill"></i>Personalized approach</li>
                </ul>
                <button class="btn-select-service active" data-calendly="individual">Select Service</button>
              </div>

              <!-- Self Care Pack -->
              <div class="service-card" data-service="selfcare-pack">
                <div class="service-icon">
                  <i class="bi bi-people-fill"></i>
                </div>
                <h4>Self Care Pack</h4>
                <div class="service-price">₹4,000 <span>(3 Sessions + Resources)</span></div>
                <ul class="service-features">
                  <li><i class="bi bi-check-circle-fill"></i>Pre-built self-care resources</li>
                  <li><i class="bi bi-check-circle-fill"></i>Guided activities</li>
                  <li><i class="bi bi-check-circle-fill"></i>Email support</li>
                </ul>
                <button class="btn-select-service" data-calendly="couple">Select Service</button>
              </div>

              <!-- Monthly Mentorship Program -->
              <div class="service-card" data-service="monthly-mentorship">
                <div class="service-icon">
                  <i class="bi bi-chat-dots-fill"></i>
                </div>
                <h4>Monthly Mentorship Program</h4>
                <div class="service-price">₹15,000 <span>/ month <small>(Only for students)</small></span></div>
                <ul class="service-features">
                  <li><i class="bi bi-check-circle-fill"></i>Ongoing mentorship</li>
                  <li><i class="bi bi-check-circle-fill"></i>Weekly check-ins</li>
                  <li><i class="bi bi-check-circle-fill"></i>Structured growth plan</li>
                </ul>
                <button class="btn-select-service" data-calendly="consultation">Select Service</button>
              </div>

            </div>
          </div>
        </div>

      <!-- Insert prebooking flow right after services (keeps it separate from booking widget) -->
      <div id="prebooking-flow" class="prebooking-flow container mb-4" style="display:none;">
        <div class="row align-items-start">
          <div class="col-12">
            <div class="card p-3">
              <div class="d-flex gap-3 align-items-start">
                <div class="pre-steps d-flex gap-2">
                  <div class="pre-step" id="pre-step-1" data-step="1"><div class="num">1</div><div class="label">Service Selected</div></div>
                  <div class="pre-step" id="pre-step-2" data-step="2"><div class="num">2</div><div class="label">Consent Form</div></div>
                  <div class="pre-step" id="pre-step-3" data-step="3"><div class="num">3</div><div class="label">Proceed to Booking</div></div>
                </div>
                <div class="flex-grow-1 pre-step-content" id="pre-step-content">
                  <div id="pre-step-1-content" class="pre-content" style="display:none;">Select a service to begin the booking flow.</div>
                  <div id="pre-step-2-content" class="pre-content" style="display:none;">
                    <!-- Inline site consent form (expanded multi-section Counselling Consent Form) -->
                    <form id="pre-consent-form">
                      <div class="mb-3"><strong>Counselling Consent Form</strong>
                        <div class="small text-muted">Please complete this form before beginning counselling with Naresh Thakur. Your information will remain confidential and is used only for counselling purposes.</div>
                        <div class="mt-2"><span class="text-danger">*</span> indicates required field</div>
                      </div>

                      <h6 class="mt-3">Section 1 — Personal Information</h6>
                      <div class="row">
                        <div class="col-md-6 mb-2">
                          <label class="form-label">Full Name <span class="text-danger">*</span></label>
                          <input required aria-required="true" name="fullName" class="form-control" placeholder="Full name">
                        </div>
                        <div class="col-md-6 mb-2">
                          <label class="form-label">Age / Date of Birth</label>
                          <input name="dob" class="form-control" placeholder="e.g. 1990-05-31 or Age: 35">
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-md-4 mb-2">
                          <label class="form-label">Gender</label>
                          <select name="gender" class="form-select">
                            <option value="">Prefer not to say</option>
                            <option>Female</option>
                            <option>Male</option>
                            <option>Non-binary</option>
                            <option>Other</option>
                          </select>
                        </div>
                        <div class="col-md-4 mb-2">
                          <label class="form-label">Contact Number</label>
                          <input name="contactNumber" class="form-control" placeholder="Phone or WhatsApp number">
                        </div>
                        <div class="col-md-4 mb-2">
                          <label class="form-label">Email <span class="text-danger">*</span></label>
                          <input required aria-required="true" name="email" type="email" class="form-control" placeholder="Email address">
                        </div>
                      </div>
                      <div class="mb-2">
                        <label class="form-label">Address</label>
                        <input name="address" class="form-control" placeholder="Address (optional)">
                      </div>

                      <h6 class="mt-3">Emergency Contact</h6>
                      <div class="row">
                        <div class="col-md-4 mb-2">
                          <label class="form-label">Name</label>
                          <input name="emergencyName" class="form-control" placeholder="Emergency contact name">
                        </div>
                        <div class="col-md-4 mb-2">
                          <label class="form-label">Relationship</label>
                          <input name="emergencyRelationship" class="form-control" placeholder="e.g. parent, spouse">
                        </div>
                        <div class="col-md-4 mb-2">
                          <label class="form-label">Contact Number</label>
                          <input name="emergencyContact" class="form-control" placeholder="Emergency contact number">
                        </div>
                      </div>

                      <div class="mb-3">
                        <label class="form-label">How did you hear about me?</label>
                        <input name="howHeard" class="form-control" placeholder="Referral, Google, Social, etc.">
                      </div>

                      <!-- Spacer: improves separation before Section 2 -->
                      <div class="mb-3 form-spacer" aria-hidden="true"></div>

                      <h6 class="mt-3">Section 2 — Presenting Concerns</h6>
                      <div class="mb-2">
                        <label class="form-label">What brings you to counselling at this time?</label>
                        <textarea name="presentingConcerns" class="form-control" rows="4" placeholder="Please describe the main concerns, issues, or reasons that brought you to counselling."></textarea>
                      </div>

                      <div class="mb-3"></div>

                      <h6 class="mt-3">Section 2b — Personal & Medical Background</h6>
                      <div class="mb-2 small text-muted">If yes, briefly explain each where applicable.</div>
                      <div class="row">
                        <div class="col-md-4 mb-2">
                          <label class="form-label">Current/previous diagnosis? (Y/N)</label>
                          <input name="medicalHistory" class="form-control" placeholder="Yes / No">
                        </div>
                        <div class="col-md-8 mb-2">
                          <label class="form-label">If yes, please list / explain</label>
                          <input name="medicalDetails" class="form-control" placeholder="Details (medication, date, reason)">
                         </div>
                        <div class="mb-3"></div>
                      </div>
                      <div class="row">
                        <div class="col-md-4 mb-2">
                          <label class="form-label">Previous counselling or therapy? (Y/N)</label>
                          <input name="counsellingHistory" class="form-control" placeholder="Yes / No">
                        </div>
                        <div class="col-md-8 mb-2">
                          <label class="form-label">If yes, when and for what reason?</label>
                          <input name="counsellingDetails" class="form-control" placeholder="Brief details">
                        </div>
                      </div>

                      <!-- Spacer to match spacing before other sections -->
                      <div class="mb-3 form-spacer" aria-hidden="true"></div>
                      <h6 class="mt-3">Section 3 — Counselling Agreement (Informed Consent)</h6>
                      <p class="small text-muted mb-2">Key points are summarised in the expanded section, please <a class="ms-1" data-bs-toggle="collapse" href="#consent-details" role="button" aria-expanded="false" aria-controls="consent-details">Read more</a> for full details.</p>

                      <div class="collapse small text-muted" id="consent-details">
                        <div class="card card-body p-3">
                          <p class="mb-2"><strong>Confidentiality</strong><br>All sessions are private and confidential. Information will not be shared without your written consent, except in cases where there is a clear and immediate risk to you or others, suspected child abuse, or legal requirements.</p>
                          <p class="mb-2"><strong>Session Duration</strong><br>Session length may vary by service; typically sessions last between 60 and 90 minutes. The service card indicates the expected duration.</p>
                          <p class="mb-2"><strong>Fees & Payment</strong><br>Fees are determined by the selected service and shown on the service card. Payment terms will be confirmed during booking or consultation.</p>
                          <p class="mb-2"><strong>Cancellation Policy</strong><br>Please inform us at least 24 hours in advance if you need to cancel or reschedule. Late cancellations may incur the full session fee.</p>
                          <p class="mb-0"><strong>Voluntary Participation & Record Keeping</strong><br>Counselling is a collaborative process. You have the right to discontinue at any time. Brief professional notes may be kept for treatment continuity and are maintained confidentially.</p>
                        </div>
                      </div>

                      <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="preConsentCheck" name="consentAgree" value="yes" required aria-required="true">
                        <label class="form-check-label" for="preConsentCheck"><span class="text-danger">*</span> I have read and understood the information above. I voluntarily agree to participate in counselling with Naresh Thakur.</label>
                      </div>

                      <!-- Spacer to match spacing before other sections -->
                      <div class="mb-3 form-spacer" aria-hidden="true"></div>
                      <h6 class="mt-3">Section 4 — Feedback (optional)</h6>
                      <div class="mb-2">
                        <label class="form-label">Any comments or expectations?</label>
                        <textarea name="feedback" class="form-control" rows="3" placeholder=""></textarea>
                      </div>

                      <div class="d-flex gap-2 mt-3 align-items-center">
                        <button class="btn btn-primary" type="submit">Submit & Continue</button>
                        <div id="pre-consent-status" class="small text-muted ms-3">Not submitted</div>
                      </div>
                    </form>
                  </div>
                  <div id="pre-step-3-content" class="pre-content" style="display:none;text-align:center;">
                    <p>All set — proceed to book your slot.</p>
                    <button id="pre-go-to-book" class="btn btn-success">Go to book your slot</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="row" data-aos="fade-up" data-aos-delay="100">

          <!-- Single full-width booking widget (Available Times removed) -->
          <div class="col-lg-12 mb-4">
            <div id="booking-widget-section" class="booking-widget-section" style="display:none;">
              <div class="section-header">
                <h3><i class="bi bi-calendar-plus me-2"></i>Book Your Slot</h3>
                <p id="selected-service-info">Counselling Session 1:1 - ₹1,500 | 60 minutes</p>
              </div>
              
              <!-- Calendly Widget Container -->
              <div class="calendly-widget-container">
                <div class="calendly-inline-widget" 
                     data-url="https://calendly.com/theselfcarebooster/new-meeting" 
                     style="min-width:320px;height:600px;">
                </div>
                <!-- Booking widget shown after consent; overlay/lock removed -->
              </div>
            </div>
          </div>

        </div>

   

     
      </div>
    </section>

  </main>

  <!-- Workspace showcase (end of page) -->
  <section class="end-workspace-showcase section">
    <div class="container" data-aos="fade-up">
      <div class="workspace-row">
        <div class="workspace-card">
          <img src="assets/img/workspace1.jpg" alt="Consultation space" loading="lazy">
          <div class="workspace-body">
            <h5>Comfortable & Confidential Space</h5>
            <p>We maintain a calm, private environment so you can focus on your well-being.</p>
          </div>
        </div>
        <div class="workspace-card">
          <img src="assets/img/workspace2.jpg" alt="Online and in-person options" loading="lazy">
          <div class="workspace-body">
            <h5>Flexible Session Options</h5>
            <p>Choose between online or in-person sessions depending on your convenience.</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer id="footer" class="footer light-background">


        <div class="container copyright text-center mt-4">
      <p>© <span>Copyright</span> <strong class="px-1 sitename">The Self Care Lab</strong> <span>All Rights
          Reserved</span></p>
      <div class="credits">
        <strong>Designed by <a href="https://www.linkedin.com/in/deven-kalathiya/" target="_blank"
            style="color:#497D74; font-weight: bold;">Deven
            Kalathiya</a></strong>
      </div>
    </div>
  </footer>

  <!-- Scroll Top -->
  <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="assets/vendor/purecounter/purecounter_vanilla.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>

  <!-- Main JS File -->
  <script src="assets/js/main.js"></script>

  <!-- Calendly Integration Script -->
  <script src="https://assets.calendly.com/assets/external/widget.js" type="text/javascript" async></script>

  <!-- Custom Booking Page Scripts -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      
      // Service selection functionality
      const serviceCards = document.querySelectorAll('.service-card');
      const selectButtons = document.querySelectorAll('.btn-select-service');
      const calendlyWidget = document.querySelector('.calendly-inline-widget');
      const serviceInfo = document.getElementById('selected-service-info');
      
      // Calendly URLs for different services
      const calendlyUrls = {
      
        individual: 'https://calendly.com/theselfcarebooster/new-meeting',
        couple: 'https://calendly.com/theselfcarebooster/new-meeting',
        consultation: 'https://calendly.com/theselfcarebooster/new-meeting'
      };
      
      // Service information (labels shown when a service is selected)
      const serviceDetails = {
        individual: 'Counselling Session 1:1 - ₹1,500 | 60 minutes',
      couple: 'Self Care Pack - ₹4,000 (3 Sessions + Resources)',
      consultation: 'Monthly Mentorship Program - ₹15,000 / month (Only for students)'
      };

    // Consent storage helpers
    // Toggle this to require consent per (email + service) instead of once-per-email.
    const REQUIRE_PER_SERVICE_CONSENT = true;
    const CONSENT_EXPIRY_MS = 86400000; // 24 hours in ms
    let consentReloadTimer = null; // scheduled reload handle
    
    function normalizeEmail(e){ try{ return (e||'').toString().trim().toLowerCase(); }catch(err){ return ''; } }
    
    // Clean up expired consent entries from localStorage
    function cleanupExpiredConsent(){ 
      try{ 
        const keysToRemove = [];
        for(let i=0; i<localStorage.length; i++){
          const key = localStorage.key(i);
          if(key && key.indexOf('consentAcknowledged_v1') === 0){
            // Check if it's a timestamp key
            if(key.endsWith(':timestamp')){
              const ts = localStorage.getItem(key);
              if(ts && Date.now() - parseInt(ts) >= CONSENT_EXPIRY_MS){
                // Expired - mark both the timestamp and the consent key for removal
                keysToRemove.push(key);
                const consentKey = key.replace(':timestamp', '');
                keysToRemove.push(consentKey);
              }
            }
          }
        }
        // Remove all expired keys
        keysToRemove.forEach(key => localStorage.removeItem(key));
      }catch(e){ console.error('Cleanup failed:', e); } 
    }

    // Schedule a page reload when the next consent entry will expire
    function scheduleConsentExpiryReload(){
      try{
        if(consentReloadTimer){ clearTimeout(consentReloadTimer); consentReloadTimer = null; }
        const now = Date.now();
        let nextReloadIn = null;
        for(let i=0; i<localStorage.length; i++){
          const key = localStorage.key(i);
          if(key && key.indexOf('consentAcknowledged_v1') === 0 && key.endsWith(':timestamp')){
            const ts = parseInt(localStorage.getItem(key));
            if(!isNaN(ts)){
              const age = now - ts;
              const remaining = CONSENT_EXPIRY_MS - age;
              if(remaining <= 0){ nextReloadIn = 1000; break; } // expired already, reload soon
              if(nextReloadIn === null || remaining < nextReloadIn){
                nextReloadIn = remaining;
              }
            }
          }
        }
        if(nextReloadIn !== null){
          const delay = Math.max(1000, Math.min(nextReloadIn, CONSENT_EXPIRY_MS));
          consentReloadTimer = setTimeout(() => {
            try{ cleanupExpiredConsent(); }catch(e){}
            location.reload();
          }, delay);
        }
      }catch(e){ /* ignore scheduling errors */ }
    }
    
    function setConsentForEmail(email){ 
      try{ 
        cleanupExpiredConsent(); // Clean up before setting new consent
        const em = normalizeEmail(email); 
        const now = Date.now(); 
        if(em){ 
          localStorage.setItem('consentAcknowledged_v1:' + em, 'true'); 
          localStorage.setItem('consentAcknowledged_v1:' + em + ':timestamp', now); 
          localStorage.setItem('consentAcknowledged_v1_last', em); 
        } else { 
          localStorage.setItem('consentAcknowledged_v1', 'true'); 
          localStorage.setItem('consentAcknowledged_v1:timestamp', now); 
        } 
        scheduleConsentExpiryReload();
      }catch(e){} 
    }
    
    function setConsentForEmailService(email, service){ 
      try{ 
        cleanupExpiredConsent(); // Clean up before setting new consent
        const em = normalizeEmail(email); 
        const now = Date.now(); 
        if(em && service){ 
          localStorage.setItem('consentAcknowledged_v1:' + em + ':' + service, 'true'); 
          localStorage.setItem('consentAcknowledged_v1:' + em + ':' + service + ':timestamp', now); 
          localStorage.setItem('consentAcknowledged_v1_last', em); 
        } else { 
          setConsentForEmail(email); 
        } 
        scheduleConsentExpiryReload();
      }catch(e){} 
    }
    
    function hasConsentForEmail(email){ 
      try{ 
        const em = normalizeEmail(email);
        if(em && localStorage.getItem('consentAcknowledged_v1:' + em) === 'true'){ 
          const ts = localStorage.getItem('consentAcknowledged_v1:' + em + ':timestamp'); 
          if(ts && Date.now() - parseInt(ts) < CONSENT_EXPIRY_MS) return true;
          // Expired - remove it
          localStorage.removeItem('consentAcknowledged_v1:' + em);
          localStorage.removeItem('consentAcknowledged_v1:' + em + ':timestamp');
        } 
        if(localStorage.getItem('consentAcknowledged_v1') === 'true'){ 
          const ts = localStorage.getItem('consentAcknowledged_v1:timestamp'); 
          if(ts && Date.now() - parseInt(ts) < CONSENT_EXPIRY_MS) return true;
          // Expired - remove it
          localStorage.removeItem('consentAcknowledged_v1');
          localStorage.removeItem('consentAcknowledged_v1:timestamp');
        } 
        return false; 
      }catch(e){ return false; } 
    }
    
    function hasConsentForEmailService(email, service){ 
      try{ 
        const em = normalizeEmail(email);
        if(em && service && localStorage.getItem('consentAcknowledged_v1:' + em + ':' + service) === 'true'){ 
          const ts = localStorage.getItem('consentAcknowledged_v1:' + em + ':' + service + ':timestamp'); 
          if(ts && Date.now() - parseInt(ts) < CONSENT_EXPIRY_MS) return true;
          // Expired - remove it
          localStorage.removeItem('consentAcknowledged_v1:' + em + ':' + service);
          localStorage.removeItem('consentAcknowledged_v1:' + em + ':' + service + ':timestamp');
        }
        if(!REQUIRE_PER_SERVICE_CONSENT && hasConsentForEmail(em)) return true; // legacy boolean fallback
        if(localStorage.getItem('consentAcknowledged_v1') === 'true'){ 
          const ts = localStorage.getItem('consentAcknowledged_v1:timestamp'); 
          if(ts && Date.now() - parseInt(ts) < CONSENT_EXPIRY_MS) return true;
          // Expired - remove it
          localStorage.removeItem('consentAcknowledged_v1');
          localStorage.removeItem('consentAcknowledged_v1:timestamp');
        }
        return false; 
      }catch(e){ return false; } 
    }
    
    function hasAnyConsent(){ 
      try{ 
        cleanupExpiredConsent(); // Clean up first
        if(localStorage.getItem('consentAcknowledged_v1') === 'true') return true; 
        for(let i=0;i<localStorage.length;i++){ 
          const k = localStorage.key(i); 
          if(k && k.indexOf('consentAcknowledged_v1:')===0 && !k.endsWith(':timestamp') && localStorage.getItem(k)==='true') return true; 
        } 
        return false; 
      }catch(e){ return false; } 
    }
    
    // Run cleanup on page load and schedule reload for the next expiry
    cleanupExpiredConsent();
    scheduleConsentExpiryReload();

    // track which service user currently selected in the UI so consent can be tied to it
    let currentSelectedService = null;

      // Book Now button handler
      try{
        const bookNowBtn = document.getElementById('book-now-btn');
        if(bookNowBtn){
          bookNowBtn.addEventListener('click', function(e){
            e.preventDefault();
            if(!currentSelectedService){
              // No service selected - show alert and scroll to services
              try{ 
                showPreConsentToast('Please select a service first', 'alert', { notifyOnly: true }); 
              }catch(err){ console.warn('toast failed', err); }
              try{ 
                const el = document.getElementById('service-cards'); 
                if(el) el.scrollIntoView({behavior:'smooth', block:'center'}); 
              }catch(e){}
            } else {
              // Service selected - check if consent form submitted
              const lastEmail = localStorage.getItem('consentAcknowledged_v1_last') || '';
              const hasConsent = currentSelectedService ? 
                localStorage.getItem('consentAcknowledged_v1:' + lastEmail + ':' + currentSelectedService) === 'true' :
                false;
              
              if(!hasConsent){
                // Form not submitted - show professional message with CTA
                try{ 
                  showPreConsentToast('Please complete the consent form to proceed', 'warning', { ctaText: 'Go to book your slot', ctaTarget: 'booking-section' }); 
                }catch(err){ console.warn('toast failed', err); }
              } else {
                // Form submitted - scroll to booking
                try{ 
                  const el = document.getElementById('booking-section'); 
                  if(el) el.scrollIntoView({behavior:'smooth', block:'start'}); 
                }catch(e){}
              }
            }
          });
        }
      }catch(e){ console.warn('book now btn setup failed', e); }

      // Helper to get Calendly URL for a service
      function getCalendlyUrlFor(service){
        try{ if(!service) return calendlyUrls['individual'] || Object.values(calendlyUrls)[0]; return calendlyUrls[service] || calendlyUrls['individual'] || Object.values(calendlyUrls)[0]; }catch(e){ return Object.values(calendlyUrls)[0]; }
      }

      // Top discovery controls: copy number and direct-call button
      try{
        const copyBtn = document.getElementById('copy-number');
        if(copyBtn){
          copyBtn.addEventListener('click', function(){
            const num = '+917506802501';
            const originalLabel = copyBtn.textContent;
            const markCopied = () => {
              try{
                copyBtn.textContent = 'Copied!';
                copyBtn.classList.add('btn-success');
                copyBtn.classList.remove('btn-outline-secondary');
                setTimeout(()=>{
                  try{ copyBtn.textContent = originalLabel; copyBtn.classList.remove('btn-success'); copyBtn.classList.add('btn-outline-secondary'); }catch(e){}
                }, 1800);
              }catch(e){}
            };

            // Try Clipboard API first; give feedback when done
            try{
              if(navigator.clipboard && navigator.clipboard.writeText){
                navigator.clipboard.writeText(num).then(markCopied).catch(()=>{ fallbackCopy(num); markCopied(); });
              } else {
                fallbackCopy(num); markCopied();
              }
            }catch(err){ fallbackCopy(num); markCopied(); }

            function fallbackCopy(t){
              try{
                const ta = document.createElement('textarea'); ta.value = t; ta.style.position = 'fixed'; ta.style.left = '-9999px'; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta);
              }catch(e){ /* fail silently */ }
            }
          });
        }
      }catch(e){}

      // Load or reset the Calendly inline widget for a given service
      // Use a fresh iframe with a cache-busting parameter to avoid showing a previous confirmation/invitation state
      function loadCalendlyFor(service){
        try{
          const baseUrl = getCalendlyUrlFor(service) || Object.values(calendlyUrls)[0];
          const cb = 'cb=' + Date.now();
          // ensure we keep existing query params and append cache-buster
          const sep = baseUrl.indexOf('?') === -1 ? '?' : '&';
          const url = baseUrl + sep + cb + '&embed_domain=' + encodeURIComponent(window.location.hostname) + '&embed_type=Inline';

          const container = document.querySelector('.calendly-widget-container');
          if(!container) return;
          // remove any existing interceptor so iframe can be interacted with while we rebuild
          try{ const existingInterceptor = container.querySelector('.booking-interceptor'); if(existingInterceptor) existingInterceptor.remove(); }catch(e){}
          // clear container
          while(container.firstChild) container.removeChild(container.firstChild);

          // create fresh iframe to force Calendly to render scheduling page (not cached confirmation)
          const iframe = document.createElement('iframe');
          iframe.src = url;
          iframe.style.width = '100%';
          iframe.style.height = '600px';
          iframe.style.border = '0';
          iframe.setAttribute('loading','lazy');
          iframe.setAttribute('title', 'Booking widget');
          container.appendChild(iframe);
        }catch(err){ console.warn('loadCalendlyFor failed', err); }
      }

      // Simple helper to reveal the booking section after consent is submitted.
      function showBookingSection(){
        try{
          const container = document.querySelector('.booking-widget-section');
          if(container){ container.style.display = 'block'; }
        }catch(e){ console.warn('showBookingSection failed', e); }
      }

      // When consent is not yet given we add a transparent interceptor DIV over the Calendly iframe
      // so clicks are captured and we can show a helpful toast asking users to complete the consent form.
      function setupBookingInterceptor(){
        try{
          const calendlyContainer = document.querySelector('.calendly-widget-container');
          if(!calendlyContainer) return;
          // ensure container has positioning so absolute child can cover it
          const prevPos = window.getComputedStyle(calendlyContainer).position;
          if(prevPos === 'static' || !prevPos) calendlyContainer.style.position = 'relative';

          // remove any existing interceptor
          const existing = calendlyContainer.querySelector('.booking-interceptor');
          if(existing) existing.remove();

          // if consent already acknowledged for the currently selected service (or any consent when none selected), don't intercept
          try{
            const lastEmail = localStorage.getItem('consentAcknowledged_v1_last') || '';
            if(currentSelectedService){ if(hasConsentForEmailService(lastEmail, currentSelectedService)) return; }
            else { if(hasAnyConsent()) return; }
          }catch(e){}

          const interceptor = document.createElement('div');
          interceptor.className = 'booking-interceptor';
          // use inline styles to keep patch minimal and robust
          interceptor.style.position = 'absolute';
          interceptor.style.inset = '0';
          interceptor.style.zIndex = '12';
          interceptor.style.background = 'transparent';
          interceptor.style.cursor = 'pointer';

          interceptor.addEventListener('click', function(e){
            e.preventDefault(); e.stopPropagation();
            try{
              // show professional toast and guide user to the consent form
              showPreConsentToast('Please complete the consent form before booking', 'warning', { ctaText: 'Go to form', ctaTarget: 'prebooking-flow' });
              const pre = document.getElementById('prebooking-flow');
              if(pre){ setTimeout(()=>{ try{ pre.scrollIntoView({behavior:'smooth', block:'center'}); }catch(err){} }, 120); }
            }catch(err){ console.warn('interceptor click failed', err); }
          });

          // Also defensively disable pointer-events on the Calendly iframe (if it exists)
          try{
            const injectedFrame = calendlyContainer.querySelector('iframe');
            if(injectedFrame){
              // store previous pointer-events if not stored
              if(!calendlyContainer.dataset._orig_pointer) calendlyContainer.dataset._orig_pointer = injectedFrame.style.pointerEvents || '';
              injectedFrame.style.pointerEvents = 'none';
            }
          }catch(e){ /* ignore */ }

          calendlyContainer.appendChild(interceptor);
        }catch(err){ console.warn('setupBookingInterceptor failed', err); }
      }

      function removeBookingInterceptor(){
        try{
          const calendlyContainer = document.querySelector('.calendly-widget-container');
          if(!calendlyContainer) return;
          const existing = calendlyContainer.querySelector('.booking-interceptor');
          if(existing) existing.remove();
          // restore pointer-events on Calendly iframe if we changed it
          try{
            const injectedFrame = calendlyContainer.querySelector('iframe');
            if(injectedFrame && calendlyContainer.dataset._orig_pointer !== undefined){
              injectedFrame.style.pointerEvents = calendlyContainer.dataset._orig_pointer || '';
              delete calendlyContainer.dataset._orig_pointer;
            }
          }catch(e){ /* ignore */ }
        }catch(e){ /* ignore */ }
      }
      
      // Handle service selection: update UI selection and displayed label, and show pre-booking flow
      selectButtons.forEach(button => {
        button.addEventListener('click', function() {
          const serviceType = this.getAttribute('data-calendly');
          currentSelectedService = serviceType;

          // When switching services, hide any previously visible booking section
          // and clear the Calendly container so a previous confirmation or widget
          // doesn't remain visible for the newly-selected service.
          try{
            const bookingSection = document.getElementById('booking-widget-section');
            if(bookingSection){ bookingSection.style.display = 'none'; }
            const calendlyContainer = document.querySelector('.calendly-widget-container');
            if(calendlyContainer){
              // remove any interceptor and clear previous contents (confirmation panel or iframe)
              try{ const existingInterceptor = calendlyContainer.querySelector('.booking-interceptor'); if(existingInterceptor) existingInterceptor.remove(); }catch(e){}
              calendlyContainer.innerHTML = '';
            }
          }catch(e){ /* ignore */ }

          // Update button states
          selectButtons.forEach(btn => btn.classList.remove('active'));
          serviceCards.forEach(card => card.classList.remove('selected'));

          this.classList.add('active');
          this.closest('.service-card').classList.add('selected');

          // Update service info (do NOT change any Calendly links or widget)
          if (serviceDetails[serviceType]) {
            serviceInfo.textContent = serviceDetails[serviceType];
          }

          // Show pre-booking flow (separate area) and set step states
          try{
            const preFlow = document.getElementById('prebooking-flow');
              if(preFlow){
              preFlow.style.display = '';
              try{ setupBookingInterceptor(); }catch(e){}
              // scroll to prebooking flow so user sees the consent form immediately
              try{ setTimeout(()=>{ preFlow.scrollIntoView({behavior:'smooth', block:'center'}); }, 120); }catch(e){}
              // If we already have consent for this (email + service) don't show the form — reveal booking
              const lastEmail = localStorage.getItem('consentAcknowledged_v1_last') || '';
              if(hasConsentForEmailService(lastEmail, serviceType)){
                // mark steps as completed and show booking
                const pre1 = document.getElementById('pre-step-1');
                const pre2 = document.getElementById('pre-step-2');
                const pre3 = document.getElementById('pre-step-3');
                [pre1,pre2,pre3].forEach(el=>{ if(el){ el.classList.remove('active','done','locked'); } });
                if(pre1) pre1.classList.add('done');
                if(pre2) pre2.classList.add('done');
                if(pre3) pre3.classList.remove('locked'), pre3.classList.add('active');
                const c1 = document.getElementById('pre-step-1-content'); const c2 = document.getElementById('pre-step-2-content'); const c3 = document.getElementById('pre-step-3-content');
                if(c1) c1.style.display='none'; if(c2) c2.style.display='none'; if(c3) c3.style.display='';
                try{ showBookingSection(); }catch(e){}
                try{ removeBookingInterceptor(); }catch(e){}
                // ensure Calendly widget matches the selected service
                try{ loadCalendlyFor(serviceType); }catch(err){}
                return;
              }
              // set pre-step visuals: 1 done, 2 active, 3 locked
              const pre1 = document.getElementById('pre-step-1');
              const pre2 = document.getElementById('pre-step-2');
              const pre3 = document.getElementById('pre-step-3');
              [pre1,pre2,pre3].forEach(el=>{ if(el){ el.classList.remove('active','done','locked'); } });
              if(pre1) pre1.classList.add('done');
              if(pre2) pre2.classList.add('active');
              if(pre3) pre3.classList.add('locked');
              // show step2 content (inline form)
              const c1 = document.getElementById('pre-step-1-content'); const c2 = document.getElementById('pre-step-2-content'); const c3 = document.getElementById('pre-step-3-content');
              if(c1) c1.style.display='none'; if(c2) c2.style.display=''; if(c3) c3.style.display='none';
              // Reset the inline consent form when showing it for a newly selected service
              try{
                const preForm = document.getElementById('pre-consent-form');
                if(preForm){
                  // Reset fields
                  preForm.reset();
                  // Restore status text
                  const statusEl = document.getElementById('pre-consent-status'); if(statusEl) statusEl.textContent = 'Not submitted';
                  // Replace submit button to remove any listeners and restore initial state
                  const oldBtn = preForm.querySelector('button[type]');
                  if(oldBtn){
                    const newBtn = oldBtn.cloneNode(true);
                    newBtn.type = 'submit';
                    newBtn.textContent = 'Submit & Continue';
                    newBtn.disabled = false;
                    oldBtn.parentNode.replaceChild(newBtn, oldBtn);
                  }
                }
              }catch(e){/* ignore reset errors */}
            }
          }catch(err){ /* ignore */ }
        });
      });
      
      // Initialize AOS animations
      if (typeof AOS !== 'undefined') {
        AOS.init({
          duration: 600,
          easing: 'ease-in-out',
          once: true,
          mirror: false
        });
      }

      // Auto-select service when passed via query string, e.g. booking.html?service=individual
      (function(){
        const params = new URLSearchParams(window.location.search);
        const svc = params.get('service');
        if(!svc) return;
        // find the button with matching data-calendly or the card with matching data-service
        const targetBtn = Array.from(selectButtons).find(b => b.getAttribute('data-calendly') === svc);
        const targetCard = Array.from(serviceCards).find(c => c.getAttribute('data-service') === svc || c.querySelector(`[data-calendly="${svc}"]`));
        if(targetBtn){
          targetBtn.click();
          // scroll to prebooking-flow (show consent form) when auto-selecting a service
          const el = document.getElementById('prebooking-flow');
          if(el){ setTimeout(()=> el.scrollIntoView({behavior:'smooth', block:'center'}), 200); }
        } else if(targetCard){
          // simulate selecting the card's button
          const btn = targetCard.querySelector('.btn-select-service');
          if(btn) btn.click();
        }
      })();
      
      // Smooth scrolling for anchor links
      document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
          // If user is trying to jump to booking section but hasn't completed consent, stop and guide them
          const href = this.getAttribute('href');
          if(href === '#booking-section'){
            // If a service is selected, require consent for that service; otherwise require any consent
            const lastEmail = localStorage.getItem('consentAcknowledged_v1_last') || '';
            const allowed = currentSelectedService ? hasConsentForEmailService(lastEmail, currentSelectedService) : hasAnyConsent();
            if(!allowed){
            e.preventDefault();
            try{
              showPreConsentToast('Please complete the consent form before booking', 'warning', { ctaText: 'Go to form', ctaTarget: 'prebooking-flow' });
              const pre = document.getElementById('prebooking-flow');
              if(pre){ setTimeout(()=>{ try{ pre.scrollIntoView({behavior:'smooth', block:'center'}); }catch(err){} }, 120); }
              // ensure interceptor is present
              try{ setupBookingInterceptor(); }catch(err){}
            }catch(err){ console.warn('booking anchor interception failed', err); }
            return;
          }
          }
          e.preventDefault();
          const target = document.querySelector(href);
          if (target) {
            target.scrollIntoView({
              behavior: 'smooth',
              block: 'start'
            });
          }
        });
      });
      
      // Prebooking flow behavior: wire inline form and go-to-book
      try{
        // Google Form configuration (optional)
        // To enable posting site form responses into your Google Form, set
        // `formAction` to the Google Form's `formResponse` endpoint and
        // fill `fieldMap` with your site field -> Google `entry.*` names.
        
        // fieldMap: { name: 'entry.123456789', email: 'entry.987654321', phone: 'entry.111222333' }
        const googleFormConfig = {
          // POST endpoint for Google Forms (use /formResponse)
        
           formAction: 'https://docs.google.com/forms/d/1LZF1uUD3B406RLP3A49CjNo_c1yBXY2zQDzPfpaQ0XM/formResponse',
          // Mapping: site field name -> Google Form entry.* name
          // Mapping: site field name -> Google Form entry.* name
          fieldMap: {
            fullName: 'entry.1348476831',
            dob: 'entry.858441035',
            gender: 'entry.834410032',
            contactNumber: 'entry.1808268710',
            email: 'entry.1449635035',
            address: 'entry.1335824046',
            emergencyName: 'entry.1709044377',
            emergencyRelationship: 'entry.1679138575',
            emergencyContact: 'entry.593998576',
            howHeard: 'entry.637344195'
          ,
            // Presenting concerns & medical/background
            presentingConcerns: 'entry.2008571777',
            medicalHistory: 'entry.1523461880',
            medicalDetails: 'entry.1377747135',
            counsellingDetails: 'entry.1061699855',
            // Consent and feedback
            consentAgree: 'entry.1304327127_sentinel',
            feedback: 'entry.993163684'
          }
        };

        // Helper: post data to Google Form using a hidden iframe + form (no CORS)
        function postToGoogleForm(data, onDone, onError){
          try{
            if(!googleFormConfig.formAction || Object.keys(googleFormConfig.fieldMap).length===0){
              (onError||function(){})(new Error('googleFormConfig not configured')); return;
            }
            console.log('[postToGoogleForm] starting', googleFormConfig.formAction);
            // build a simple map of the inputs we're about to send for debugging
            const mapped = Object.keys(googleFormConfig.fieldMap).reduce((acc,k)=>{ acc[googleFormConfig.fieldMap[k]] = data[k]||''; return acc; }, {});
            console.log('[postToGoogleForm] mapped payload:', mapped);
            const iframeName = 'gf-post-iframe-' + Date.now();
            const iframe = document.createElement('iframe');
            iframe.name = iframeName;
            iframe.style.display = 'none';
            document.body.appendChild(iframe);

            const form = document.createElement('form');
            form.action = googleFormConfig.formAction;
            form.method = 'POST';
            form.target = iframeName;
            form.style.display = 'none';

            // map data keys to Google entry.* fields
            Object.keys(googleFormConfig.fieldMap).forEach(k => {
              const entryName = googleFormConfig.fieldMap[k];
              const input = document.createElement('input');
              input.type = 'hidden';
              input.name = entryName;
              input.value = data[k] || '';
              form.appendChild(input);
            });

            // Add a small timeout/fallback: treat success after load or 3s
            let finished = false;
            function cleanupAndDone(err){
              if(finished) return; finished = true;
              setTimeout(()=>{
                try{ if(form && form.parentNode) form.parentNode.removeChild(form); }catch(e){}
                try{ if(iframe && iframe.parentNode) iframe.parentNode.removeChild(iframe); }catch(e){}
              }, 250);
              if(err){ (onError||function(){})(err); } else { (onDone||function(){})(); }
            }

            iframe.addEventListener('load', function(){ console.log('[postToGoogleForm] iframe load'); cleanupAndDone(); });
            // fallback
            const fallbackTimer = setTimeout(() => { cleanupAndDone(); }, 3000);

            document.body.appendChild(form);
            // submit
            try{ form.submit(); }catch(e){ clearTimeout(fallbackTimer); cleanupAndDone(e); }
          }catch(err){ (onError||function(){})(err); }
        }

        const preForm = document.getElementById('pre-consent-form');
        if(preForm){
          preForm.addEventListener('submit', function(ev){
            ev.preventDefault();

            // collect site form fields (expanded consent form)
            const formData = {
              fullName: (preForm.querySelector('[name="fullName"]')||{value:''}).value.trim(),
              dob: (preForm.querySelector('[name="dob"]')||{value:''}).value.trim(),
              gender: (preForm.querySelector('[name="gender"]')||{value:''}).value.trim(),
              contactNumber: (preForm.querySelector('[name="contactNumber"]')||{value:''}).value.trim(),
              email: (preForm.querySelector('[name="email"]')||{value:''}).value.trim(),
              address: (preForm.querySelector('[name="address"]')||{value:''}).value.trim(),
              emergencyName: (preForm.querySelector('[name="emergencyName"]')||{value:''}).value.trim(),
              emergencyRelationship: (preForm.querySelector('[name="emergencyRelationship"]')||{value:''}).value.trim(),
              emergencyContact: (preForm.querySelector('[name="emergencyContact"]')||{value:''}).value.trim(),
              howHeard: (preForm.querySelector('[name="howHeard"]')||{value:''}).value.trim(),
              presentingConcerns: (preForm.querySelector('[name="presentingConcerns"]')||{value:''}).value.trim(),
              medicalHistory: (preForm.querySelector('[name="medicalHistory"]')||{value:''}).value.trim(),
              medicalDetails: (preForm.querySelector('[name="medicalDetails"]')||{value:''}).value.trim(),
              counsellingHistory: (preForm.querySelector('[name="counsellingHistory"]')||{value:''}).value.trim(),
              counsellingDetails: (preForm.querySelector('[name="counsellingDetails"]')||{value:''}).value.trim(),
              consentAgree: (preForm.querySelector('[name="consentAgree"]')||{checked:false}).checked ? 'yes' : 'no',
              feedback: (preForm.querySelector('[name="feedback"]')||{value:''}).value.trim()
            };

            function onConsentSet(){
              try{ setConsentForEmailService(formData.email, currentSelectedService); }catch(e){}
              // mark pre-step2 done and enable pre-step3
              const pre2 = document.getElementById('pre-step-2'); const pre3 = document.getElementById('pre-step-3');
              if(pre2) { pre2.classList.remove('active'); pre2.classList.add('done'); }
              if(pre3) { pre3.classList.remove('locked'); pre3.classList.add('active'); }

              // show next-step content (pre-step-3) and hide the form content (pre-step-2)
              try{
                const c1 = document.getElementById('pre-step-1-content');
                const c2 = document.getElementById('pre-step-2-content');
                const c3 = document.getElementById('pre-step-3-content');
                if(c2) c2.style.display = 'none';
                if(c3) c3.style.display = '';
                // scroll the next-step into view so user sees the Go to Booking action
                if(c3){ setTimeout(()=>{ try{ c3.scrollIntoView({behavior:'smooth', block:'center'}); }catch(e){} }, 100); }
              }catch(e){ console.warn('show next step failed', e); }

                // reveal booking section (step3)
                try{ showBookingSection(); }catch(e){ /* ignore */ }
                try{ removeBookingInterceptor(); }catch(e){}
                // load Calendly widget for the service the user just gave consent for
                try{ loadCalendlyFor(currentSelectedService); }catch(err){}

              // also update main steps: step2 done, step3 active
              try{ const s2 = document.getElementById('bs-step-2'); const s3 = document.getElementById('bs-step-3'); if(s2){ s2.classList.remove('active'); s2.classList.add('done'); } if(s3){ s3.classList.remove('locked'); s3.classList.add('active'); } }catch(e){}
              // auto-scroll to booking section so the user sees the Calendly widget immediately
              try{ const bookingEl = document.getElementById('booking-widget-section') || document.getElementById('booking-section'); if(bookingEl){ setTimeout(()=>{ try{ bookingEl.scrollIntoView({behavior:'smooth', block:'start'}); }catch(e){} }, 300); } }catch(e){}
            }

            // If googleFormConfig is configured, attempt to POST into Google Form first
            const statusEl = document.getElementById('pre-consent-status');
            if(googleFormConfig.formAction && Object.keys(googleFormConfig.fieldMap).length>0){
              // disable submit to prevent double clicks
              const submitBtn = preForm.querySelector('button[type="submit"]'); if(submitBtn) submitBtn.disabled = true;
              if(statusEl) statusEl.textContent = 'Posting to Google Form...';
              postToGoogleForm(formData, function(){
                if(submitBtn) submitBtn.disabled = false;
                if(statusEl) statusEl.textContent = 'Form successfully submitted — you can now book your slot';
                console.log('[pre-consent-form] posted to Google Form');
                // show toast popup confirmation (not inside form)
                try{
                  const message = 'Form successfully submitted. You can now book your slot.';
                  showPreConsentToast(message, 'success', { ctaText: 'Go to book your slot', ctaTarget: 'booking-widget-section' });
                }catch(e){}
                // change submit button into "Submit another response" which resets the form
                try{
                  const submitBtn = preForm.querySelector('button[type="submit"]');
                  if(submitBtn){
                    submitBtn.textContent = 'Submit another response';
                    submitBtn.dataset.posted = 'true';
                    submitBtn.type = 'button';
                    submitBtn.addEventListener('click', function resetAfterPost(ev){
                      // reset form fields
                      preForm.reset();
                      // restore button
                      submitBtn.textContent = 'Submit & Continue';
                      submitBtn.type = 'submit';
                      delete submitBtn.dataset.posted;
                      // clear status
                      const statusEl = document.getElementById('pre-consent-status'); if(statusEl) statusEl.textContent = 'Not submitted';
                      // remove toast if present
                      const to = document.getElementById('pre-consent-toast'); if(to){ try{ const bs = bootstrap.Toast.getInstance(to); if(bs) bs.hide(); }catch(e){} }
                      // remove this listener once used
                      submitBtn.removeEventListener('click', resetAfterPost);
                    });
                  }
                }catch(e){}
                onConsentSet();
              }, function(err){
                // On error, still set consent locally but log error; user can still proceed
                console.warn('Google Form post failed or not configured', err);
                if(submitBtn) submitBtn.disabled = false;
                if(statusEl) statusEl.textContent = 'Failed to submit to Google — saved locally. You can now book your slot';
                try{ showPreConsentToast('Submission failed to Google but your response was saved locally. You can still book your slot', 'warning', { ctaText: 'Go to book your slot', ctaTarget: 'booking-widget-section' }); }catch(e){}
                try{
                  const submitBtn = preForm.querySelector('button[type="submit"]');
                  if(submitBtn){
                    submitBtn.textContent = 'Submit another response';
                    submitBtn.dataset.posted = 'true';
                    submitBtn.type = 'button';
                    submitBtn.addEventListener('click', function resetAfterPost(ev){
                      preForm.reset();
                      submitBtn.textContent = 'Submit & Continue';
                      submitBtn.type = 'submit';
                      delete submitBtn.dataset.posted;
                      const statusEl = document.getElementById('pre-consent-status'); if(statusEl) statusEl.textContent = 'Not submitted';
                      const to = document.getElementById('pre-consent-toast'); if(to){ try{ const bs = bootstrap.Toast.getInstance(to); if(bs) bs.hide(); }catch(e){} }
                      submitBtn.removeEventListener('click', resetAfterPost);
                    });
                  }
                }catch(e){}
                onConsentSet();
              });
            } else {
              // default behavior (no Google Form integration configured)
              if(statusEl) statusEl.textContent = 'Form saved locally — you can now book your slot';
              try{ showPreConsentToast('Your responses were saved locally. You can now book your slot', 'success', { ctaText: 'Go to book your slot', ctaTarget: 'booking-widget-section' }); }catch(e){}
              try{
                const submitBtn = preForm.querySelector('button[type="submit"]');
                if(submitBtn){
                  submitBtn.textContent = 'Submit another response';
                  submitBtn.dataset.posted = 'true';
                  submitBtn.type = 'button';
                  submitBtn.addEventListener('click', function resetAfterPost(ev){
                    preForm.reset();
                    submitBtn.textContent = 'Submit & Continue';
                    submitBtn.type = 'submit';
                    delete submitBtn.dataset.posted;
                    const statusEl = document.getElementById('pre-consent-status'); if(statusEl) statusEl.textContent = 'Not submitted';
                    const to = document.getElementById('pre-consent-toast'); if(to){ try{ const bs = bootstrap.Toast.getInstance(to); if(bs) bs.hide(); }catch(e){} }
                    submitBtn.removeEventListener('click', resetAfterPost);
                  });
                }
              }catch(e){}
              onConsentSet();
            }
          });
        }

        // (Removed Open Google Form button behavior — site now posts directly and shows inline confirmation)

        // Utility: show a toast notification for pre-consent actions
        // options: { ctaText: string, ctaTarget: elementId }
        function showPreConsentToast(message, level, options){
          try{
            const toastEl = document.getElementById('pre-consent-toast');
            const body = document.getElementById('pre-consent-toast-body');
            if(!toastEl || !body) return;
            body.textContent = message;
                // prepare icon and styles
                const iconEl = toastEl.querySelector('.toast-icon');
                const titleEl = document.getElementById('pre-consent-toast-title');
                // set title if provided - or hide if notifyOnly
                try{ 
                  if(options && options.notifyOnly){
                    titleEl.style.display = 'none';
                  } else {
                    titleEl.style.display = '';
                    if(options && options.title) titleEl.textContent = options.title; 
                    else titleEl.textContent = (level==='warning' ? 'Action required' : 'Submission complete');
                  }
                }catch(e){}
                const timeEl = document.getElementById('pre-consent-toast-time');
                const bodyEl = document.getElementById('pre-consent-toast-body');
                const cta = document.getElementById('pre-consent-toast-cta');
                if(bodyEl) bodyEl.textContent = message;
                if(timeEl) timeEl.textContent = 'now';
                // icon SVGs
                const successSVG = '<svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="11" fill="#16a34a"/><path d="M7.5 12.5l2.5 2.5L16.5 9" stroke="#fff" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>';
                const alertSVG = '<svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="11" fill="#ef4444"/><path d="M12 7v6" stroke="#fff" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 16h.01" stroke="#fff" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>';
                const warnSVG = '<svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="11" fill="#f59e0b"/><path d="M12 7v6" stroke="#fff" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 16h.01" stroke="#fff" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>';
                
                if(iconEl){ 
                  if(level === 'alert') iconEl.innerHTML = alertSVG;
                  else if(level === 'warning') iconEl.innerHTML = warnSVG;
                  else iconEl.innerHTML = successSVG;
                }
                // CTA: hide if notifyOnly
                const actionsContainer = document.getElementById('pre-consent-toast-actions');
                if(options && options.notifyOnly){
                  if(actionsContainer) actionsContainer.style.display = 'none !important';
                } else {
                  if(actionsContainer) actionsContainer.style.display = '';
                  if(cta){
                    // set CTA label and target
                    try{ cta.textContent = (options && options.ctaText) ? options.ctaText : 'Go to book your slot'; }catch(e){}
                    const targetId = (options && options.ctaTarget) ? options.ctaTarget : 'booking-widget-section';
                    cta.onclick = function(){
                      try{ const el = document.getElementById(targetId) || document.getElementById('booking-section'); if(el){ el.scrollIntoView({behavior:'smooth', block:'start'}); }
                      }catch(e){}
                    };
                  }
                }
                // show toast
                toastEl.classList.remove('toast-success','toast-warning','toast-alert');
                if(level === 'alert') toastEl.classList.add('toast-alert');
                else if(level === 'warning') toastEl.classList.add('toast-warning');
                else toastEl.classList.add('toast-success');
                const bs = new bootstrap.Toast(toastEl, { delay: 6000 });
                bs.show();
          }catch(e){ console.warn('toast failed', e); }
        }

        const preGo = document.getElementById('pre-go-to-book');
        if(preGo){
          preGo.addEventListener('click', function(){
            // Check consent for the currently selected service (if any). If none selected, fall back to any consent.
            const lastEmail = localStorage.getItem('consentAcknowledged_v1_last') || '';
            const ok = currentSelectedService ? hasConsentForEmailService(lastEmail, currentSelectedService) : hasAnyConsent();
            if(ok){
              const widget = document.getElementById('booking-widget-section') || document.getElementById('booking-section');
              if(widget) widget.scrollIntoView({behavior:'smooth', block:'start'});
              const s3 = document.getElementById('bs-step-3'); if(s3){ s3.classList.add('active'); }
              try{ showPreConsentToast('Go to book your slot', 'success'); }catch(e){}
            } else {
              const consentModalEl = document.getElementById('consentModal'); if(typeof bootstrap!=='undefined' && consentModalEl){ const m = new bootstrap.Modal(consentModalEl); m.show(); }
            }
          });
        }
        // initial state: if consent already acknowledged show booking section, otherwise keep it hidden
        try{
          if(hasAnyConsent()){
            try{ showBookingSection(); }catch(e){}
          } else {
            // keep booking hidden until form submission
            try{ const container = document.querySelector('.booking-widget-section'); if(container){ container.style.display = 'none'; } }catch(e){}
          }
          // Ensure interceptor is installed early so clicking the Calendly area is captured
          try{ setupBookingInterceptor(); }catch(e){}
        }catch(e){ /* ignore */ }
      }catch(e){ /* ignore */ }
    
      // Listen for Calendly postMessage events to detect scheduled events and show a professional toast
      try{
        window.addEventListener('message', function(ev){
          try{
            const data = ev && ev.data;
            if(!data) return;
            // Calendly SDK posts messages with event names like 'calendly.event_scheduled'
            if(typeof data === 'object' && data.event === 'calendly.event_scheduled'){
              // When a booking is scheduled, replace the Calendly widget with a confirmation panel
              try{
                const container = document.querySelector('.calendly-widget-container');
                if(container){
                  // Hide/replace the widget so the user cannot open the raw invitation link from the embed
                  container.innerHTML = '';
                  const conf = document.createElement('div');
                  conf.className = 'booking-confirmation-panel';
                  conf.innerHTML = '<div style="padding:22px;text-align:left;">'
                    + '<h4 style="margin:0 0 8px;color:#0f5132;">Booking Confirmed</h4>'
                    + '<p style="margin:0 0 8px;color:#0f5132;">Your slot has been submitted successfully. Please check your email for the appointment details and joining link.</p>'
                    + '<p style="margin:0 0 12px;color:#475569;font-size:0.95rem;">If you want to book another service, click the button below.</p>'
                    + '<div><button id="booking-confirm-go-services" class="btn btn-primary">Go to services</button></div>'
                    + '</div>';
                  container.appendChild(conf);
                  // wire the button to scroll to services
                  const btn = document.getElementById('booking-confirm-go-services');
                  if(btn){ btn.addEventListener('click', function(){ try{ const el = document.getElementById('service-cards'); if(el) el.scrollIntoView({behavior:'smooth', block:'start'}); }catch(e){} }); }
                }
              }catch(err){ /* ignore */ }
              // Show professional booking confirmation toast with CTA to go to services and instruct to check email
              showPreConsentToast('Your slot has been submitted successfully. Please check your email for appointment details and the joining link.', 'success', { title: 'Booking Confirmed', ctaText: 'Go to services', ctaTarget: 'service-cards' });
            }
          }catch(err){ /* ignore */ }
        }, false);
      }catch(err){ /* ignore */ }
      
    });
  </script>

  <!-- Toast container for pre-consent notifications (professional design) -->
  <div aria-live="polite" aria-atomic="true" class="position-fixed top-0 end-0 p-3" style="z-index: 1080;">
    <div id="pre-consent-toast" class="toast pre-consent-toast" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="toast-body d-flex align-items-start gap-3">
        <div class="toast-icon flex-shrink-0">
          <!-- icon will be injected -->
        </div>
        <div class="flex-grow-1">
          <div class="d-flex align-items-center justify-content-between">
            <div>
              <strong id="pre-consent-toast-title">Submission complete</strong>
              <div class="small text-muted" id="pre-consent-toast-time">now</div>
            </div>
            <div>
              <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
          </div>
          <div class="mt-2" id="pre-consent-toast-body">Form successfully submitted. You can now book your slot.</div>
          <div class="mt-3 d-flex gap-2 align-items-center" id="pre-consent-toast-actions">
            <button id="pre-consent-toast-cta" class="btn btn-sm btn-primary">Go to book your slot</button>
            <button id="pre-consent-toast-action" class="btn btn-sm btn-outline-secondary" data-bs-dismiss="toast">Dismiss</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Booking Page Styles -->
  <style>
    /* Booking Page Specific Styles */
    /* Form spacing: increase vertical space after each section inside the consent form */
    #pre-consent-form h6 { margin-top: 1.2rem; margin-bottom: 0.85rem; }
    #pre-consent-form .mb-2, #pre-consent-form .mb-3 { margin-bottom: 1.05rem !important; }
    /* small extra space after rows/blocks to improve readability */
    #pre-consent-form .row { margin-bottom: 0.6rem; }
    #pre-consent-form .form-check { margin-top: 0.6rem; margin-bottom: 0.9rem; }
    /* explicit spacer used between certain sections for clearer separation */
    #pre-consent-form .form-spacer { height: 1.6rem; }
    .booking-page {
      background: var(--background-color);
    }

    /* Hero Section */
    #booking-hero {
      background: linear-gradient(135deg, rgba(207, 231, 198, 0.1) 0%, rgba(239, 233, 213, 0.8) 100%);
      /* tightened vertical spacing */
      padding: 60px 0 30px;
      text-align: center;
    }

    .hero-content h1 {
      color: var(--heading-color);
      font-size: 3rem;
      font-weight: 700;
      margin-bottom: 20px;
    }

    /* Make hero container responsive and vertically centered */
    #booking-hero .container {
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      min-height: 320px; /* ensures content isn't cropped on small screens */
      padding-top: 18px;
      padding-bottom: 18px;
      box-sizing: border-box;
    }

    /* Allow stats to wrap and reduce spacing on small screens */
    .hero-stats { flex-wrap: wrap; gap: 14px; }
    .hero-stats .stat-item { font-size: 0.95rem; }

    /* Reduce heading sizes on narrow viewports to avoid cropping */
    @media (max-width: 768px) {
      .hero-content h1 { font-size: 2rem; line-height: 1.1; }
      .hero-subtitle { font-size: 1rem; margin-bottom: 18px; }
      #booking-hero { padding: 36px 0 20px; }
      #booking-hero .container { min-height: 260px; }
    }

    @media (max-width: 420px) {
      .hero-content h1 { font-size: 1.6rem; }
      .hero-stats { gap: 10px; }
      .hero-stats .stat-item { font-size: 0.9rem; }
    }

    /* New hero grid layout: image1 (left/top), content (center, spanning rows), image2 (right/bottom) */
    .hero-grid { display:grid; grid-template-columns: 1fr minmax(320px, 560px) 1fr; grid-template-rows: auto auto; gap: 18px; align-items: center; }
    .hero-img-wrap { display:flex; align-items:center; justify-content:center; }
    .hero-img1 { grid-column: 1; grid-row: 1; justify-items:start; }
    .hero-main { grid-column: 2; grid-row: 1 / span 2; }
    .hero-img2 { grid-column: 3; grid-row: 2; justify-items:end; }
    .hero-img { max-width: 100%; width: 100%; height: auto; display: block; border-radius: 10px; }
    .hero-center .hero-subtitle { margin-bottom:18px; max-width:560px; margin-left:auto; margin-right:auto; }
    .hero-stats { display:flex; gap:28px; justify-content:center; margin-top:10px; }
    .hero-stats .stat-item { display:flex; align-items:center; gap:10px; color:var(--default-color); font-weight:600; }
    .hero-stats .stat-item i { font-size:20px; color:var(--accent-color); }

    .hero-subtitle {
      color: var(--default-color);
      font-size: 1.2rem;
      margin-bottom: 40px;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }

    /* Professional toast styles */
    .pre-consent-toast.toast {
      min-width: 320px;
      max-width: 420px;
      border-radius: 12px;
      box-shadow: 0 8px 30px rgba(15, 23, 42, 0.15);
      border: 1px solid rgba(15,23,42,0.06);
      background: #fff;
    }
    .pre-consent-toast .toast-body { padding: 16px; }
    .pre-consent-toast .toast-icon { width: 40px; height: 40px; display:flex; align-items:center; justify-content:center; }
    .pre-consent-toast.toast-success .toast-icon svg { display:block; }
    .pre-consent-toast.toast-warning .toast-icon svg { display:block; }
    .pre-consent-toast.toast-alert .toast-icon svg { display:block; }
    .pre-consent-toast .btn { font-size: 0.85rem; }
    #pre-consent-toast-actions.d-none { display: none !important; }
    #pre-consent-toast-action { display: none; }
    #pre-consent-toast-actions { justify-content: center; }

  /* Prebooking flow styles */
  /* Show the stepper horizontally on top of the content (steps row above the form) */
  .prebooking-flow .card > .d-flex { display:flex; flex-direction:column; gap:12px; }
  .prebooking-flow .pre-steps{ display:flex; flex-direction:row; gap:12px; justify-content:center; width:100%; }
  .prebooking-flow .pre-step{ display:flex; gap:12px; align-items:center; padding:8px 12px; border-radius:10px; border:1px solid rgba(0,0,0,0.04); cursor:pointer; background:transparent; transition:all .18s ease; }
  .prebooking-flow .pre-step .num{ width:40px; height:40px; border-radius:50%; background:#f3f4f6; display:flex; align-items:center; justify-content:center; color:var(--accent-color); font-weight:800; font-size:15px; }
  .prebooking-flow .pre-step .label{ font-size:14px; color:var(--default-color); font-weight:600; }
  .prebooking-flow .pre-step.active{ box-shadow:0 10px 28px rgba(0,0,0,0.06); transform:translateY(-2px); background: linear-gradient(90deg, rgba(255,255,255,0.9), rgba(255,255,255,0.95)); }
  .prebooking-flow .pre-step.done{ background: linear-gradient(90deg, color-mix(in srgb, var(--accent-color), white 85%) 0%, rgba(0,0,0,0.02) 100%); }
  .prebooking-flow .pre-step.done .num{ background:var(--accent-color); color:var(--surface-color); box-shadow:0 4px 12px rgba(0,0,0,0.08); }
  .prebooking-flow .pre-step.locked{ opacity:0.6; }
  /* Make active step circle stand-out */
  .prebooking-flow .pre-step.active .num{ background:#fff; color:var(--accent-color); border:2px solid var(--accent-color); }
  /* Ensure labels wrap nicely and the content area gets full width below the steps */
  .prebooking-flow .pre-step-content{ width:100%; }
  /* Force prebooking flow layout to be full-width and not overlap header or other elements */
  .prebooking-flow{ position:static !important; width:100%; max-width:100%; margin:18px auto; z-index:1; }
  .prebooking-flow .card{ overflow:visible; }
  /* Ensure the inline consent form doesn't float or position unexpectedly */
  .prebooking-flow .pre-step-content .pre-content{ position:relative; }

  /* Responsive: if viewport is very narrow, allow the steps to wrap onto two lines */
  @media (max-width: 480px) {
    .prebooking-flow .pre-steps{ gap:8px; flex-wrap:wrap; }
    .prebooking-flow .pre-step{ padding:8px 10px; font-size:13px; }
  }
  /* Small discovery card wrapper to match service-card look */
  .small-discovery-card-wrapper { margin-top: 8px; margin-bottom: 18px; }
  .small-discovery-card {
    display: inline-flex;
    align-items: center;
    gap: 12px;
    padding: 12px 16px;
    border-radius: 10px;
    border: 1px solid rgba(0,0,0,0.06);
    background: #ffffff;
    box-shadow: 0 8px 22px rgba(15,23,42,0.06);
    max-width: 920px;
  }
  .small-discovery-text {
    font-weight: 600;
    color: var(--default-color, #064);
    font-size: 1rem;
  }
  .small-discovery-controls .btn { white-space: nowrap; }
  @media (max-width: 576px) {
    .small-discovery-card { flex-direction: column; text-align: center; gap: 10px; }
    .small-discovery-text { font-size: 0.95rem; }
    .small-discovery-controls { width: 100%; justify-content: center; gap: 8px; }
  }

    .hero-stats {
      display: flex;
      justify-content: center;
      gap: 40px;
      flex-wrap: wrap;
    }

    .stat-item {
      display: flex;
      align-items: center;
      gap: 10px;
      color: var(--accent-color);
      font-weight: 600;
    }

    .stat-item i {
      font-size: 24px;
    }

    /* Service Cards */
    .service-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 30px;
      margin-bottom: 50px;
    }

    .service-card {
      background: var(--surface-color);
      border: 2px solid rgba(207, 231, 198, 0.3);
      border-radius: 20px;
      padding: 35px 30px;
      text-align: center;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .service-card:hover,
    .service-card.selected {
      border-color: var(--accent-color);
      transform: translateY(-5px);
      box-shadow: 0 15px 40px rgba(207, 231, 198, 0.3);
    }

    .service-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: var(--accent-color);
      transform: scaleX(0);
      transition: transform 0.3s ease;
    }

    .service-card:hover::before,
    .service-card.selected::before {
      transform: scaleX(1);
    }

    .service-icon {
      width: 80px;
      height: 80px;
      background: linear-gradient(135deg, var(--accent-color) 0%, color-mix(in srgb, var(--accent-color), black 10%) 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 20px;
    }

    .service-icon i {
      font-size: 36px;
      color: white;
    }

    .service-card h4 {
      color: var(--heading-color);
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 15px;
    }

    .service-price {
      color: var(--accent-color);
      font-size: 28px;
      font-weight: 800;
      margin-bottom: 20px;
    }

    .service-price span {
      font-size: 16px;
      font-weight: 500;
      color: var(--default-color);
    }

    .service-features {
      list-style: none;
      padding: 0;
      margin: 0 0 25px 0;
    }

    .service-features li {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
      color: var(--default-color);
    }

    .service-features i {
      color: var(--accent-color);
      font-size: 16px;
    }

    .btn-select-service {
      background: transparent;
      border: 2px solid var(--accent-color);
      color: var(--accent-color);
      padding: 12px 30px;
      border-radius: 50px;
      font-weight: 600;
      transition: all 0.3s ease;
      cursor: pointer;
      width: 100%;
    }

    .btn-select-service:hover,
    .btn-select-service.active {
      background: var(--accent-color);
      color: white;
    }

    /* Booking Sections */
    .calendar-section,
    .booking-widget-section {
      background: var(--surface-color);
      border-radius: 20px;
      padding: 35px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
      border: 1px solid rgba(207, 231, 198, 0.3);
      height: 100%;
    }

    .section-header h3 {
      color: var(--heading-color);
      font-weight: 700;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
    }

    .section-header p {
      color: var(--default-color);
      margin-bottom: 25px;
      font-size: 16px;
    }

    .calendar-container {
      border-radius: 15px;
      overflow: hidden;
      margin-bottom: 20px;
      border: 2px solid rgba(207, 231, 198, 0.4);
    }

    .calendar-note {
      background: rgba(207, 231, 198, 0.15);
      padding: 15px;
      border-radius: 10px;
      color: var(--default-color);
      border-left: 4px solid var(--accent-color);
      font-size: 14px;
    }

    .calendly-widget-container {
      border-radius: 15px;
      overflow: hidden;
      border: 2px solid rgba(207, 231, 198, 0.4);
    }

    /* Booking overlay/lock styles removed - booking will be hidden/shown by script instead */

    /* Info Cards */
    .info-card {
      background: var(--surface-color);
      border-radius: 20px;
      padding: 35px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
      border: 1px solid rgba(207, 231, 198, 0.3);
      height: 100%;
    }

    .info-card h4 {
      color: var(--heading-color);
      font-weight: 700;
      margin-bottom: 25px;
      display: flex;
      align-items: center;
    }

    /* Process Steps */
    .process-steps {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .step {
      display: flex;
      align-items: flex-start;
      gap: 15px;
    }

    .step-number {
      width: 35px;
      height: 35px;
      background: var(--accent-color);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      flex-shrink: 0;
    }

    .step-content h6 {
      color: var(--heading-color);
      font-weight: 600;
      margin-bottom: 5px;
    }

    .step-content p {
      color: var(--default-color);
      margin: 0;
      font-size: 14px;
    }

    /* Policies */
    .policies {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .policy-item {
      display: flex;
      align-items: flex-start;
      gap: 15px;
    }

    .policy-item i {
      color: var(--accent-color);
      font-size: 20px;
      margin-top: 2px;
      flex-shrink: 0;
    }

    .policy-item strong {
      color: var(--heading-color);
      display: block;
      margin-bottom: 5px;
    }

    .policy-item p {
      color: var(--default-color);
      margin: 0;
      font-size: 14px;
    }

    /* Emergency Section */
    .emergency-section {
      background: linear-gradient(135deg, rgba(220, 38, 38, 0.1) 0%, rgba(239, 68, 68, 0.05) 100%);
      border: 2px solid rgba(220, 38, 38, 0.2);
      border-radius: 15px;
      padding: 30px;
      text-align: center;
    }

    .emergency-header {
      margin-bottom: 20px;
    }

    .emergency-header h4 {
      color: #dc2626;
      font-weight: 700;
      margin: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .emergency-content p {
      color: var(--default-color);
      margin-bottom: 20px;
    }

    .emergency-contacts {
      display: flex;
      justify-content: center;
      gap: 30px;
      flex-wrap: wrap;
    }

    .contact-item {
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: center;
    }

    .contact-item strong {
      color: var(--heading-color);
      font-size: 14px;
    }

    .emergency-number {
      color: #dc2626;
      text-decoration: none;
      font-weight: 700;
      font-size: 18px;
      padding: 10px 20px;
      background: rgba(220, 38, 38, 0.1);
      border-radius: 10px;
      transition: all 0.3s ease;
    }

    .emergency-number:hover {
      background: rgba(220, 38, 38, 0.2);
      transform: translateY(-2px);
      color: #dc2626;
    }

    /* Responsive Design */
    @media (max-width: 992px) {
      .hero-content h1 {
        font-size: 2.5rem;
      }
      
      .hero-stats {
        gap: 20px;
      }
      
      .service-cards {
        grid-template-columns: 1fr;
      }
      
      .emergency-contacts {
        flex-direction: column;
        gap: 15px;
      }
    }

    /* End-of-page workspace showcase */
    .end-workspace-showcase { padding: 40px 0 28px; }
    .end-workspace-showcase .workspace-row { display:grid; grid-template-columns: repeat(2, 1fr); gap:24px; align-items:stretch; }
    .workspace-card { background: var(--surface-color); border-radius:14px; overflow:hidden; border:1px solid rgba(15,23,42,0.04); box-shadow:0 8px 30px rgba(15,23,42,0.04); }
    .workspace-card img { width:100%; height:auto; display:block; }
    .workspace-card .workspace-body { padding:16px; }
    .workspace-card h5 { margin:0 0 6px; font-size:1rem; color:var(--heading-color); }
    .workspace-card p { margin:0; color:var(--default-color); font-size:0.95rem; }
    @media (max-width: 768px) {
      .end-workspace-showcase .workspace-row { grid-template-columns: 1fr; }
    }

    @media (max-width: 768px) {
      #booking-hero {
        padding: 50px 0 24px;
      }
      
      .hero-content h1 {
        font-size: 2rem;
      }
      
      .hero-stats {
        flex-direction: column;
        gap: 15px;
      }
      
      .calendar-section,
      .booking-widget-section,
      .info-card {
        padding: 25px;
      }
      
      .calendly-inline-widget {
        height: 500px !important;
      }
    }

    @media (max-width: 992px) {
      .hero-grid { grid-template-columns: 1fr minmax(280px, 520px) 1fr; }
      .hero-img { max-width:220px; height:auto; }
      .hero-stats { gap:14px; flex-wrap:wrap; }
    }

    @media (max-width: 576px) {
      .hero-grid { display:block; }
      .hero-img { max-width:100%; height:auto; margin: 0 auto; }
      .hero-main { margin: 18px 0; text-align: center; }
      .hero-center h1 { font-size:1.9rem; }
    }
  </style>

</body>
</html>